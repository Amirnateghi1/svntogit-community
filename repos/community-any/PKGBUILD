# $Id$
# Maintainer: Johannes LÃ¶thberg <johannes@kyriasis.com>
# Contributor: Sergej Pupykin <pupykin.s+arch@gmail.com>
# Contributor: Timm Preetz <timm@preetz.us>
# Contributor: Michael 'manveru' Fellinger <m.fellinger@gmail.com>
# Contributor: Dave Pretty <david dot pretty at gmail dot com>

pkgname=anki
pkgver=2.1.0beta39
pkgrel=1

pkgdesc="Helps you remember facts (like words/phrases in a foreign language) efficiently"
url="https://ankisrs.net/"
arch=('any')
license=('AGPL3')

depends=('qt5-webengine' 'python-beautifulsoup4' 'python-pyaudio'
         'python-pyqt5' 'python-requests' 'python-send2trash'
         'python-decorator' 'python-markdown')
optdepends=('lame: record sound'
            'mplayer: play sound')

source=(https://apps.ankiweb.net/downloads/beta/anki-$pkgver-source.tgz
        0001-Revert-refuse-to-run-on-qt-5.10.patch)
sha256sums=('a6b511ac81bc7024b63ba997f1fd00880c4b574d6b52cedee2ef3d24fa36da49'
            '9f10126ffc9e9a3552bee20b750d6a43ec631280ad0838c9f7d2b188998c5ac1')

prepare() {
  cd anki-$pkgver

  patch -p1 <"$srcdir"/0001-Revert-refuse-to-run-on-qt-5.10.patch
}

package() {
  cd anki-$pkgver

  make install DESTDIR="$pkgdir"

  sed -i '$ iimport os\nos.environ["QTWEBENGINE_DISABLE_SANDBOX"] = "1"' "$pkgdir"/usr/bin/anki
}
